

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Lab Exercise 5: QAM-PSK &#8212; Interactive Digital Communtications</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../_static/tabs.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/custom.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/Digcom_Lab5';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lab Exercise 6: FSK-MSK" href="Digcom_Lab6.html" />
    <link rel="prev" title="Lab Exercise 4: Nyquist signaling and L-ASK" href="Digcom_Lab4.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Interactive Digital Communtications - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Interactive Digital Communtications - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">About</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../digital_communications_intro.html">Digital Communications and Interactivity</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lab Exercises</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Digcom_Lab1.html">Lab Exercise 1: Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Digcom_Lab2.html">Lab Exercise 2: Digital Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="Digcom_Lab3.html">Lab Exercise 3: Matched Filters and L-ASK</a></li>
<li class="toctree-l1"><a class="reference internal" href="Digcom_Lab4.html">Lab Exercise 4: Nyquist signaling and L-ASK</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lab Exercise 5: QAM-PSK</a></li>
<li class="toctree-l1"><a class="reference internal" href="Digcom_Lab6.html">Lab Exercise 6: FSK-MSK</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ntua-el17840/Interactive-Digital-Communications" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ntua-el17840/Interactive-Digital-Communications/issues/new?title=Issue%20on%20page%20%2Fcontent/Digcom_Lab5.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/content/Digcom_Lab5.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lab Exercise 5: QAM-PSK</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions">Questions</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab-exercise-5-qam-psk">
<h1>Lab Exercise 5: QAM-PSK<a class="headerlink" href="#lab-exercise-5-qam-psk" title="Permalink to this heading">#</a></h1>
<img alt="../_images/QAM16_Demonstration.gif" class="align-center" src="../_images/QAM16_Demonstration.gif" />
<div class="admonition-live-code admonition">
<p class="admonition-title">Live Code</p>
<p>Press the following button to make python code interactive. It will connect you to a kernel once it says “ready” (might take a bit, especially the first time it runs).</p>
</div>
<div style="text-align: center;">
  <button title="Launch thebe" class="thebelab-button thebe-launch-button" onclick="initThebe()">Python Interactive Code</button>
</div>
<section id="questions">
<h2>Questions<a class="headerlink" href="#questions" title="Permalink to this heading">#</a></h2>
<p><font size="3">1  ) Plot a 64-QAM signal constellation of a complete rectangular grid, with the binary words next to each of its points marked [as in figure 5.4(b) of the Course Notes] with Gray coding.</font></p>
<p>Hint: Use the section of commands 26-34 from Code 5.2 of the Course Notes (repeated below,
for convenience) to produce a mapping vector containing all points of the signal constellation
in ascending codeword order: mapping(1) -&gt; 00..00, mapping (2)-&gt;00..01, … With the
scatterplot() command, plot the points of the signal constellation and with appropriate
text addition commands write near each point the corresponding code word [e.g. the
command text(3,3,num2str(de2bi(4,3,’left-msb’)), ‘FontSize’, 6); writes
the codeword “1 0 0” at point (3,3) of the figure with font size 6].</p>
<div class="cell tag_thebe-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">VBox</span><span class="p">,</span> <span class="n">Output</span><span class="p">,</span> <span class="n">Dropdown</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log</span>
<span class="kn">import</span> <span class="nn">array</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">upfirdn</span><span class="p">,</span><span class="n">decimate</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">erfc</span>
</pre></div>
</div>
</div>
</div>
<div class="tab-set docutils">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">Python</label><div class="tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The mapping vector for M-QAM Gray coding</span>
<span class="c1"># It is for a complete rectangular constellation, of dimension M=L^2</span>
<span class="c1"># l=log2(L): number of bits per dimension (inphase, quadrature)</span>
<span class="n">core</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="p">])</span> <span class="c1"># trivial case, M=4</span>
<span class="n">mapping</span> <span class="o">=</span> <span class="n">core</span>

<span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">core</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mapping</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">mapping</span><span class="p">)])</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mapping</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">mapping</span><span class="p">))])</span>
        
<span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>

</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">Matlab</label><div class="tab-content docutils">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% The mapping vector for M-QAM Gray coding</span>
<span class="c">% It is for a complete rectangular constellation, of dimension M=L^2</span>
<span class="c">% l=log2(L): number of bits per dimension (inphase, quadrature)</span>
<span class="n">core</span><span class="p">=[</span><span class="mi">1</span><span class="o">+</span><span class="nb">i</span><span class="p">;</span><span class="mi">1</span><span class="o">-</span><span class="nb">i</span><span class="p">;</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="nb">i</span><span class="p">;</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="nb">i</span><span class="p">];</span><span class="w"> </span><span class="c">% trivial case, M=4</span>
<span class="n">mapping</span><span class="p">=</span><span class="n">core</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">j</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span>
<span class="w"> </span><span class="n">mapping</span><span class="p">=</span><span class="n">mapping</span><span class="o">+</span><span class="nb">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">core</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w"> </span><span class="n">mapping</span><span class="p">=[</span><span class="n">mapping</span><span class="p">;</span><span class="nb">conj</span><span class="p">(</span><span class="n">mapping</span><span class="p">)];</span>
<span class="w"> </span><span class="n">mapping</span><span class="p">=[</span><span class="n">mapping</span><span class="p">;</span><span class="o">-</span><span class="nb">conj</span><span class="p">(</span><span class="n">mapping</span><span class="p">)];</span>
<span class="w"> </span><span class="k">end</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-code-cell tag_thebe-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_qam_constellation</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">L</span> <span class="o">*</span> <span class="n">L</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">L</span><span class="p">))</span>
    
    <span class="c1"># Core QAM constellation points</span>
    <span class="n">core</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="p">])</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="n">core</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">core</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mapping</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">mapping</span><span class="p">)])</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mapping</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">mapping</span><span class="p">))])</span>
            
    <span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># Gray code labels</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">bin</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">)]</span>

    <span class="c1"># Plotting the constellation</span>
    <span class="k">with</span> <span class="n">out</span><span class="p">:</span>
        <span class="n">out</span><span class="o">.</span><span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mapping</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">mapping</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span>  <span class="c1"># Label offsets</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">real</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span> <span class="o">+</span> <span class="n">dy</span><span class="p">,</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">L</span><span class="p">,</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">L</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">L</span><span class="p">,</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">L</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">L</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">L</span><span class="si">}</span><span class="s2"> QAM Constellation&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;In-phase&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Quadrature&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Dropdown for selecting L</span>
<span class="n">L_dropdown</span> <span class="o">=</span> <span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Select L:&#39;</span><span class="p">)</span>

<span class="c1"># Output widget for the plot</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">Output</span><span class="p">()</span>

<span class="c1"># Display widgets</span>
<span class="n">vbox</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">([</span><span class="n">L_dropdown</span><span class="p">,</span> <span class="n">out</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">vbox</span><span class="p">)</span>

<span class="c1"># Update plot based on dropdown selection</span>
<span class="k">def</span> <span class="nf">on_value_change</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
    <span class="n">plot_qam_constellation</span><span class="p">(</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">])</span>

<span class="n">L_dropdown</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">on_value_change</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>

<span class="c1"># Initial plot</span>
<span class="n">plot_qam_constellation</span><span class="p">(</span><span class="n">L_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "2b5959c8620e478cbbf0478b31c02693"}</script></div>
</div>
<p><font size="3"> 2)We have available the 6.75-9.25 MHz bandpass channel and want to transmit
at a rate of 10 Mbps. Select a complete rectangular constellation and Nyquist
signaling M-QAM system suitable for this purpose. Choose the smallest
possible M and an appropriate roll-off value to take advantage of all available
bandwidth. Simulate transmitter and receiver and plot the Pb vs Eb/No curve
theoretically and experimentally. The sampling frequency must be sufficiently
high so that the signals of all modulation-demodulation stages can be
represented without aliasing.</font></p>
<p>Connection with theory: The transmission rate, R (bits/s), is related to the symbol rate, 1/Τ
(also called baud rate) and the size of the signal constellation, M, with the relation
$$</p>
<p>\frac{R}{\log_2 L} = \frac{l}{T}</p>
<div class="math notranslate nohighlight">
\[On the other hand, the required bandwidth for bandpass transmission with Nyquist signaling
is equal to
\]</div>
<p>W = \frac{1}{T}(1+\alpha)</p>
<div class="math notranslate nohighlight">
\[
where α is the roll-off factor of the Nyquist filter used. Combining the
above relations, we conclude that the size of the constellation must satisfy the inequality: 
\]</div>
<p>log_2 M &gt;= \frac{R}{W}(1+\alpha), 0&lt;a&lt;=1</p>
<p>$$</p>
<img alt="../_images/Lab5_1.png" class="align-center" src="../_images/Lab5_1.png" />
<p>Result: a = 0.25</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rootRaisedCosine</span><span class="p">(</span><span class="n">nsamp</span><span class="p">,</span> <span class="n">roll_off</span><span class="p">,</span> <span class="n">delay</span><span class="p">):</span>
    <span class="n">F0</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">nsamp</span>
    <span class="n">Fd</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">Fs</span> <span class="o">=</span> <span class="n">Fd</span> <span class="o">*</span> <span class="n">nsamp</span>
    <span class="n">Td</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Fd</span>
    <span class="n">Ts</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Fs</span>
    <span class="n">F1</span> <span class="o">=</span> <span class="n">F0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">roll_off</span><span class="p">)</span>
    <span class="n">F2</span> <span class="o">=</span> <span class="n">F0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">roll_off</span><span class="p">)</span>
    <span class="n">filter_order</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nsamp</span> <span class="o">*</span> <span class="n">delay</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">filter_order</span><span class="p">,</span> <span class="n">Td</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)):</span>
        <span class="n">t_shifted</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">filter_order</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">t_shifted</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">F0</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">roll_off</span> <span class="o">*</span> <span class="p">((</span><span class="mi">4</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">t_shifted</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">/</span> <span class="n">roll_off</span> <span class="o">/</span> <span class="n">F0</span> <span class="ow">or</span> <span class="n">t_shifted</span> <span class="o">==</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">/</span> <span class="n">roll_off</span> <span class="o">/</span> <span class="n">F0</span> <span class="p">:</span>
            <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">roll_off</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">F0</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">/</span> <span class="n">roll_off</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">/</span> <span class="n">roll_off</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">factor1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">F0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">64</span> <span class="o">*</span> <span class="n">roll_off</span><span class="o">*</span> <span class="n">roll_off</span> <span class="o">*</span> <span class="n">F0</span> <span class="o">*</span> <span class="n">F0</span> <span class="o">*</span> <span class="n">t_shifted</span> <span class="o">*</span> <span class="n">t_shifted</span><span class="p">)</span>
            <span class="n">factor2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">F1</span> <span class="o">*</span> <span class="n">t_shifted</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">F0</span> <span class="o">*</span> <span class="n">t_shifted</span><span class="p">)</span>
            <span class="n">factor3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">roll_off</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">F2</span> <span class="o">*</span> <span class="n">t_shifted</span><span class="p">)</span> 
            <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">factor1</span> <span class="o">*</span> <span class="p">(</span><span class="n">factor2</span> <span class="o">+</span> <span class="n">factor3</span><span class="p">))</span>


  <span class="c1">#  plt.plot(t,h)</span>
   <span class="c1"># plt.grid()</span>
    <span class="c1">#plt.show()</span>
    
    <span class="k">return</span> <span class="n">h</span>

<span class="k">def</span> <span class="nf">ber_64qam</span><span class="p">(</span><span class="n">EbNo</span><span class="p">):</span>
    <span class="n">a</span><span class="o">=</span><span class="mf">0.25</span>
    <span class="n">L</span><span class="o">=</span><span class="mi">8</span>
    <span class="n">l</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
    <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">l</span>
    <span class="n">M</span><span class="o">=</span><span class="mi">64</span>
    <span class="n">Nsymb</span><span class="o">=</span><span class="mi">30000</span>
    <span class="c1"># προσομοίωση πομπού</span>
    <span class="n">nsamp</span><span class="o">=</span><span class="mi">16</span>
    <span class="n">fc</span><span class="o">=</span><span class="mi">4</span>
    <span class="n">SNR</span><span class="o">=</span><span class="n">EbNo</span><span class="o">-</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nsamp</span><span class="o">/</span><span class="n">k</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#σε db</span>
    <span class="n">core</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="p">]</span>
    <span class="n">mapping</span><span class="o">=</span><span class="n">core</span><span class="p">[:]</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">)):</span>
            <span class="n">mapping</span><span class="o">=</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">core</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mapping</span><span class="p">)))</span>
            <span class="n">conj_arr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
            <span class="n">mapping</span><span class="o">=</span> <span class="n">mapping</span> <span class="o">+</span> <span class="n">conj_arr</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">conj_arr</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
            <span class="n">mapping</span><span class="o">=</span> <span class="n">mapping</span> <span class="o">+</span> <span class="n">conj_arr</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            
    <span class="c1">#παράγουμε τυχαία ακολουθία</span>
    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">Nsymb</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">x_temp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">k</span><span class="p">)),</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>
    <span class="n">xsym</span><span class="o">=</span><span class="p">[]</span>

    <span class="c1"># χωρίζω τη λίστα σε επιμέρους λίστες και βάζω τα περιεχόμενα </span>
    <span class="c1">#της καθεμίας σε ένα string ώστε με την εντολή int() να </span>
    <span class="c1"># μετατραπεί από binary σε decimal</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x_temp</span><span class="p">)):</span>
        <span class="n">my_str</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="n">y</span><span class="o">=</span><span class="n">x_temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">M</span><span class="p">))):</span>
            <span class="n">my_str</span><span class="o">=</span><span class="n">my_str</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
        <span class="n">a</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">my_str</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">xsym</span><span class="o">=</span><span class="n">xsym</span><span class="o">+</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>

    <span class="n">y</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">xsym</span><span class="p">)):</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y</span> <span class="o">+</span> <span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="n">xsym</span><span class="p">[</span><span class="n">n</span><span class="p">]]]</span>
    
    <span class="n">delay</span><span class="o">=</span><span class="mi">10</span>
    <span class="n">filtorder</span><span class="o">=</span> <span class="n">delay</span><span class="o">*</span><span class="n">nsamp</span><span class="o">*</span><span class="mi">2</span>
    <span class="n">rolloff</span><span class="o">=</span><span class="mf">0.25</span>

    <span class="n">shaping_filter</span><span class="o">=</span><span class="n">rootRaisedCosine</span><span class="p">(</span><span class="n">nsamp</span><span class="p">,</span> <span class="n">rolloff</span><span class="p">,</span> <span class="n">delay</span><span class="p">)</span>
    <span class="n">ytx</span><span class="o">=</span><span class="n">upfirdn</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">nsamp</span><span class="p">)</span> <span class="c1">#upsample</span>
    <span class="n">ytx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ytx</span><span class="p">,</span><span class="n">shaping_filter</span><span class="p">)</span>
    <span class="n">m</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ytx</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">ytx</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fc</span><span class="o">*</span><span class="n">m</span><span class="o">/</span><span class="n">nsamp</span><span class="p">)))</span>
    
    <span class="n">s_matrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="c1">#ανάστροφος</span>
    <span class="n">s_matrix</span><span class="o">=</span><span class="n">s_matrix</span><span class="o">.</span><span class="n">getH</span><span class="p">()</span>
    <span class="n">s_list</span><span class="o">=</span><span class="n">s_matrix</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">Ps</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">s_list</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="c1">#ισχύς μιγαδικού σήματος σε db</span>
    <span class="n">Pn</span><span class="o">=</span><span class="n">Ps</span><span class="o">-</span><span class="n">SNR</span>

    <span class="n">n</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">Pn</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ytx</span><span class="p">))</span>
    <span class="n">snoisy</span><span class="o">=</span><span class="n">s</span><span class="o">+</span><span class="n">n</span>
    
    <span class="c1">#δέκτης</span>
    <span class="n">yrx</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">snoisy</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fc</span><span class="o">*</span><span class="n">m</span><span class="o">/</span><span class="n">nsamp</span><span class="p">))</span>
    <span class="n">yrx</span><span class="o">=</span><span class="n">yrx</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
    <span class="n">yrx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">yrx</span><span class="p">,</span><span class="n">shaping_filter</span><span class="p">)</span>
    <span class="n">yrx</span><span class="o">=</span><span class="n">yrx</span><span class="p">[::</span><span class="n">nsamp</span><span class="p">]</span> <span class="c1">#downsample </span>
    
    <span class="n">yrx</span><span class="o">=</span><span class="n">yrx</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">delay</span><span class="o">+</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">yrx</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">delay</span><span class="p">]</span>
    
    <span class="n">yi</span><span class="o">=</span><span class="n">yrx</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">yq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span>
    <span class="n">yi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span>
    
    <span class="n">xrx</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">q</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yrx</span><span class="p">)):</span>
        <span class="n">differences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="n">yi</span><span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="c1"># Πίνακας με τις διαφορές του σήματος από τα επίπεδα</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">differences</span><span class="p">)</span>
        <span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">differences</span> <span class="o">==</span> <span class="n">m</span><span class="p">)</span>
        <span class="n">yi</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">differences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="n">yq</span><span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="c1"># Πίνακας με τις διαφορές του σήματος από τα επίπεδα</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">differences</span><span class="p">)</span>
        <span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">differences</span> <span class="o">==</span> <span class="n">m</span><span class="p">)</span>
        <span class="n">yq</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">error</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yrx</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">yq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">+=</span> <span class="mi">1</span> 
    <span class="k">return</span> <span class="p">(</span><span class="n">error</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    
<span class="n">ber_exp</span><span class="o">=</span><span class="p">[]</span>
<span class="n">ber_th</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">15</span><span class="p">):</span>
    <span class="n">ber_exp</span><span class="o">=</span><span class="n">ber_exp</span><span class="o">+</span><span class="p">[</span><span class="n">ber_64qam</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
    <span class="n">ber_th</span> <span class="o">=</span> <span class="n">ber_th</span> <span class="o">+</span><span class="p">[((</span><span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span><span class="p">(</span><span class="n">L</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">L</span><span class="p">))</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">special</span><span class="o">.</span><span class="n">erfc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">L</span> <span class="o">*</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">10</span><span class="p">))))]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">ber_exp</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">ber_th</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Simulation&#39;</span><span class="p">,</span> <span class="s1">&#39;Theoretical&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Eb/N0(db)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Bit Error Probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;BER curve for 64-QAM&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">line</span> <span class="mi">126</span>
<span class="g g-Whitespace">    </span><span class="mi">124</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">15</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span>     <span class="n">ber_exp</span><span class="o">=</span><span class="n">ber_exp</span><span class="o">+</span><span class="p">[</span><span class="n">ber_64qam</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
<span class="ne">--&gt; </span><span class="mi">126</span>     <span class="n">ber_th</span> <span class="o">=</span> <span class="n">ber_th</span> <span class="o">+</span><span class="p">[((</span><span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span><span class="p">(</span><span class="n">L</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">L</span><span class="p">))</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">special</span><span class="o">.</span><span class="n">erfc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">L</span> <span class="o">*</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">10</span><span class="p">))))]</span>
<span class="g g-Whitespace">    </span><span class="mi">128</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">129</span> <span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">ber_exp</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;L&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p><font size="3">  3) If, for the system in question 2, the maximum normalized signal-to-noise ratio,
Eb/No, that you can achieve at the receiver, is 10 db, and the channel encoder
you have requires that the bit error probability does not exceed 0.005, fall back
into a lower-order, rectangular grid QAM system again, without changing the
other signaling parameters. What is the maximum baud rate now? Plot the
power spectrum density of your signals again and see if there are any
differences. Examine if a less fall back in a non-rectangular grid system could
satisfy the required transmission quality..</font></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># για μέγιστο Eb/N0=10db και μέγιστο Pb=0.002 βρίσκουμε από το σχήμα 5.11 </span>
<span class="c1"># ότι το κατάλληλο σύστημα είναι αυτό για Μ=16</span>
<span class="c1"># ο μέγιστος ρυθμός απόδοσης είναι: R&lt;=log2(M)*W/(1+a)=8Mbps</span>


<span class="k">def</span> <span class="nf">MQAM</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
    <span class="n">a</span><span class="o">=</span><span class="mf">0.25</span>
    <span class="n">l</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
    <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">l</span>
    <span class="n">M</span><span class="o">=</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">Nsymb</span><span class="o">=</span><span class="mi">30000</span>
    <span class="c1"># προσομοίωση πομπού</span>
    <span class="n">nsamp</span><span class="o">=</span><span class="mi">16</span>
    <span class="n">fc</span><span class="o">=</span><span class="mi">4</span>
    <span class="n">SNR</span><span class="o">=</span><span class="n">L</span><span class="o">-</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nsamp</span><span class="o">/</span><span class="n">k</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#σε db</span>
    <span class="n">core</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="p">]</span>
    <span class="n">mapping</span><span class="o">=</span><span class="n">core</span><span class="p">[:]</span>
    <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">)):</span>
            <span class="n">mapping</span><span class="o">=</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">core</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mapping</span><span class="p">)))</span>
            <span class="n">conj_arr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
            <span class="n">mapping</span><span class="o">=</span> <span class="n">mapping</span> <span class="o">+</span> <span class="n">conj_arr</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">conj_arr</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
            <span class="n">mapping</span><span class="o">=</span> <span class="n">mapping</span> <span class="o">+</span> <span class="n">conj_arr</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="c1">#παράγουμε τυχαία ακολουθία</span>
    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">Nsymb</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">x_temp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">k</span><span class="p">)),</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>
    <span class="n">xsym</span><span class="o">=</span><span class="p">[]</span>

    <span class="c1"># χωρίζω τη λίστα σε επιμέρους λίστες και βάζω τα περιεχόμενα </span>
    <span class="c1">#της καθεμίας σε ένα string ώστε με την εντολή int() να </span>
    <span class="c1"># μετατραπεί από binary σε decimal</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x_temp</span><span class="p">)):</span>
        <span class="n">my_str</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="n">y</span><span class="o">=</span><span class="n">x_temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">M</span><span class="p">))):</span>
            <span class="n">my_str</span><span class="o">=</span><span class="n">my_str</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
        <span class="n">a</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">my_str</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">xsym</span><span class="o">=</span><span class="n">xsym</span><span class="o">+</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>

    <span class="n">y</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">xsym</span><span class="p">)):</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y</span> <span class="o">+</span> <span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="n">xsym</span><span class="p">[</span><span class="n">n</span><span class="p">]]]</span>

    <span class="n">delay</span><span class="o">=</span><span class="mi">10</span>
    <span class="n">filtorder</span><span class="o">=</span> <span class="n">delay</span><span class="o">*</span><span class="n">nsamp</span><span class="o">*</span><span class="mi">2</span>
    <span class="n">rolloff</span><span class="o">=</span><span class="mf">0.25</span>

    <span class="n">shaping_filter</span><span class="o">=</span><span class="n">rootRaisedCosine</span><span class="p">(</span><span class="n">nsamp</span><span class="p">,</span> <span class="n">rolloff</span><span class="p">,</span> <span class="n">delay</span><span class="p">)</span>
    <span class="n">ytx</span><span class="o">=</span><span class="n">upfirdn</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">nsamp</span><span class="p">)</span> <span class="c1">#upsample</span>
    <span class="n">ytx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ytx</span><span class="p">,</span><span class="n">shaping_filter</span><span class="p">)</span>
    <span class="n">m</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ytx</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">ytx</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fc</span><span class="o">*</span><span class="n">m</span><span class="o">/</span><span class="n">nsamp</span><span class="p">)))</span>

    <span class="n">s_matrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="c1">#ανάστροφος</span>
    <span class="n">s_matrix</span><span class="o">=</span><span class="n">s_matrix</span><span class="o">.</span><span class="n">getH</span><span class="p">()</span>
    <span class="n">s_list</span><span class="o">=</span><span class="n">s_matrix</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">Ps</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">s_list</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="c1">#ισχύς μιγαδικού σήματος σε db</span>
    <span class="n">Pn</span><span class="o">=</span><span class="n">Ps</span><span class="o">-</span><span class="n">SNR</span>

    <span class="n">n</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">Pn</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ytx</span><span class="p">))</span>
    <span class="n">snoisy</span><span class="o">=</span><span class="n">s</span><span class="o">+</span><span class="n">n</span>

    <span class="c1">#δέκτης</span>
    <span class="n">yrx</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">snoisy</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fc</span><span class="o">*</span><span class="n">m</span><span class="o">/</span><span class="n">nsamp</span><span class="p">))</span>
    <span class="n">yrx</span><span class="o">=</span><span class="n">yrx</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
    <span class="n">yrx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">yrx</span><span class="p">,</span><span class="n">shaping_filter</span><span class="p">)</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">Pxx_den</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">yrx</span><span class="p">),</span> <span class="n">window</span><span class="o">=</span><span class="s1">&#39;hamming&#39;</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="mi">8196</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">,</span><span class="n">Pxx_den</span>

<span class="c1"># Υπολογίζουμε την φασματική πυκνότητα ισχύος του ληφθέντος σήματος</span>
<span class="n">f</span><span class="p">,</span><span class="n">Pxx_den</span><span class="o">=</span><span class="n">MQAM</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">Pxx_den</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Pxx_den</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Pxx_den</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="p">,</span><span class="n">Pxx_den</span><span class="o">=</span><span class="n">MQAM</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">Pxx_den</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Pxx_den</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Pxx_den</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Φασματική πυκνότητα ισχύος του ληφθέντος σήματος&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Normalized frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Power/frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Μ=16&#39;</span><span class="p">,</span> <span class="s1">&#39;Μ=64&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/712984a8130a57630365238fc274a02bd5aaa17508b057a17a192ebb5a677dac.png" src="../_images/712984a8130a57630365238fc274a02bd5aaa17508b057a17a192ebb5a677dac.png" />
</div>
</div>
<p><font size="3">4) How much can the bit rate in question 3 be increased if the roll-off of the
Nyquist filter can be reduced by 50%;</font></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Για 64-QAM  M=64</span>
<span class="n">W</span><span class="o">=</span><span class="p">(</span><span class="mf">9.25</span><span class="o">-</span><span class="mf">6.75</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
<span class="n">a</span><span class="o">=</span><span class="mf">0.125</span> <span class="c1"># μειωθεί στο μισό του το roll-off του φίλτρου Nyquist</span>
<span class="n">R</span><span class="o">=</span><span class="n">W</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">a</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nέος ρυθμός μετάδοσης&quot;</span> <span class="p">,</span><span class="n">R</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">),</span><span class="s2">&quot;Mbps&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nέος ρυθμός μετάδοσης 13.333333333333334 Mbps
</pre></div>
</div>
</div>
</div>
<p><font size="3">5) (Optional) Simulate a PSK system, of the same modulation order and with the
same roll-off factor of Nyquist signals, as the QAM of question 3. Compare with
the latter (a) in terms of BER, (b) in terms of bandwidth, after designing the
BER-EbNo curve and the spectrum of the generated signal. Gray coding should
also be used here, implementing the procedure described in Frame 5.10 of the
Course Notes, with the help of the code:</font></p>
<div class="tab-set docutils">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1">Python</label><div class="tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The mapping vector for M-QAM Gray coding</span>
<span class="c1"># It is for a complete rectangular constellation, of dimension M=L^2</span>
<span class="c1"># l=log2(L): number of bits per dimension (inphase, quadrature)</span>
<span class="n">core</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="p">])</span> <span class="c1"># trivial case, M=4</span>
<span class="n">mapping</span> <span class="o">=</span> <span class="n">core</span>

<span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">core</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mapping</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">mapping</span><span class="p">)])</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mapping</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">mapping</span><span class="p">))])</span>
        
<span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>

</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2">Matlab</label><div class="tab-content docutils">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% The mapping vector for M-PSK Gray coding</span>
<span class="n">k</span><span class="p">=</span><span class="nb">log2</span><span class="p">(</span><span class="n">M</span><span class="p">);</span>
<span class="n">ph1</span><span class="p">=[</span><span class="nb">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">];</span>
<span class="n">theta</span><span class="p">=[</span><span class="n">ph1</span><span class="p">;</span><span class="w"> </span><span class="o">-</span><span class="n">ph1</span><span class="p">;</span><span class="w"> </span><span class="nb">pi</span><span class="o">-</span><span class="n">ph1</span><span class="p">;</span><span class="w"> </span><span class="o">-</span><span class="nb">pi</span><span class="o">+</span><span class="n">ph1</span><span class="p">];</span>
<span class="n">mapping</span><span class="p">=</span><span class="nb">exp</span><span class="p">(</span>1<span class="nb">j</span><span class="o">*</span><span class="n">theta</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">)</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">j</span><span class="p">=</span><span class="mi">3</span><span class="p">:</span><span class="n">k</span>
<span class="w"> </span><span class="n">theta</span><span class="p">=</span><span class="n">theta</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
<span class="w"> </span><span class="n">mapping</span><span class="p">=</span><span class="nb">exp</span><span class="p">(</span>1<span class="nb">j</span><span class="o">*</span><span class="n">theta</span><span class="p">);</span>
<span class="w"> </span><span class="n">mapping</span><span class="p">=[</span><span class="n">mapping</span><span class="p">;</span><span class="w"> </span><span class="o">-</span><span class="nb">conj</span><span class="p">(</span><span class="n">mapping</span><span class="p">)];</span>
<span class="w"> </span><span class="n">theta</span><span class="p">=</span><span class="nb">real</span><span class="p">(</span><span class="nb">log</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span><span class="o">/</span>1<span class="nb">j</span><span class="p">);</span>
<span class="w"> </span><span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "ntua-el17840/Interactive-Digital-Communications",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Digcom_Lab4.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lab Exercise 4: Nyquist signaling and L-ASK</p>
      </div>
    </a>
    <a class="right-next"
       href="Digcom_Lab6.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lab Exercise 6: FSK-MSK</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions">Questions</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By ECE - NTUA
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>